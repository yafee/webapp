var moreBtn_content={NORMAL:"点击查看更多 &raquo;",LOADING:"加载中...",NOMORE:"没有更多"};var frist_tab_name={RECOMMEND:"推荐众筹",PERFORM:"演出众筹",STAR:"星动众筹",DREAM:"梦想众筹",LATEST:"最新上线",EXPENSIVE:"金额最高",SUPPORT:"支持最多"};
var second_tab_name={ALL:"全部",VARIETY:"综艺",CONCERT:"音乐",OTHER:"其他"};var left_tab_name={INDEX:"首页",LIVE:"Live&nbsp;House",LAI:"来斯秀",PAI:"排行榜"};var right_list={UINFO:"我的资料",UWALLET:"我的钱包",ULOVE:"我的关注",UORDER:"我的订单",SHARE:"分享有礼",LOGOUT:"退出登录"};
var zan_img={NORMAL:"imgs/panxi/zan@3x.png",ACITVE:"imgs/index/zan-0.png"};var modal_tip={NOTLOGIN:"请先登录哦～"};$(function(){var f=$("#tuijian"),e=$("#quanbu"),n=$("#renqi"),g=$("#dream"),B=$("#paihang"),l=$(".kind"),m=$("#tab").children("a"),G=B.find("ul"),q=e.find(".paihang").find("ul"),d="",F,D=recPage=xinPage=dreamPage=1,c=session.getItem("userId"),a=window.location;
var H={checkContainer:function(J){var I;switch(J){case frist_tab_name.LATEST:case frist_tab_name.EXPENSIVE:case frist_tab_name.SUPPORT:I=B;break;case frist_tab_name.PERFORM:case second_tab_name.ALL:case second_tab_name.VARIETY:case second_tab_name.CONCERT:case second_tab_name.OTHER:I=e;
break;case frist_tab_name.RECOMMEND:I=f;break;case frist_tab_name.STAR:I=n;break;case frist_tab_name.DREAM:I=g;break;}return I;},findMoreBtn:function(I){return this.checkContainer(I).find(".more").children("a");
},normal:function(I){this.findMoreBtn(I).html(moreBtn_content.NORMAL);},loading:function(I){this.findMoreBtn(I).html(moreBtn_content.LOADING);},nomore:function(I){this.findMoreBtn(I).html(moreBtn_content.NOMORE);
}};getLocation();x();m.on("click",function(){changeTabColor(m,$(this));switch($.trim($(this).html())){case frist_tab_name.RECOMMEND:displayController([e,n,g],f,true);
initPage($(".tuijian"));break;case frist_tab_name.PERFORM:e.find(".am-slider").flexslider().addClass("am-animation-fade");e.find(".more").show();d=$.trim($(this).html());
if($.trim(q.html())==""){D=1;A($(this).html(),q);F=l.find("div");F.each(function(){$(this).on("click",function(){var I=$(this).find("span");d=I.html();
F.removeClass("active-kind");$(this).addClass("active-kind");l.find("span").css("color","#ccc");switch($.trim(I.html())){case second_tab_name.ALL:I.css("color","#1dbcd2");
break;case second_tab_name.VARIETY:I.css("color","#82d758");break;case second_tab_name.CONCERT:I.css("color","#fe5262");break;case second_tab_name.OTHER:I.css("color","#546fb4");
break;}q.empty();D=1;A($(this).find("span").html(),q);});});}l.is(":hidden")&&l.show();displayController([f,n,g],e,true);break;case frist_tab_name.STAR:n.find(".more").show();
if(!n.find(".renqi").html()){xinPage=1;w();}displayController([f,e,g],n,true);break;case frist_tab_name.DREAM:b();displayController([f,e,n],g,true);break;
case frist_tab_name.LATEST:case frist_tab_name.EXPENSIVE:case frist_tab_name.SUPPORT:G.hide().empty();B.find(".more").children("a").html(moreBtn_content.NORMAL);
D=1,d=$(this).html();A($(this).html(),G);G.show();break;}});$("#left-nav").delegate("li",clickEvent(),function(){var I=$.trim($(this).find("span").html());
switch($.trim(I)){case left_tab_name.INDEX:m.last().show();m.eq(0).html(frist_tab_name.RECOMMEND);m.eq(1).html(frist_tab_name.PERFORM);m.eq(2).html(frist_tab_name.STAR);
changeTabColor(m,m.eq(0));m.css("width","23%");displayController([e,n,B],f,false);$("#leftside").offCanvas("close");break;case left_tab_name.LIVE:a.href="live.html";
break;case left_tab_name.LAI:a.href="panxi.html";break;case left_tab_name.PAI:m.last().hide();m.eq(0).html(frist_tab_name.LATEST);m.eq(1).html(frist_tab_name.EXPENSIVE);
m.eq(2).html(frist_tab_name.SUPPORT).show();changeTabColor(m,m.eq(0));m.css("width","32%");if($.trim(G.html())==""){D=1;A(frist_tab_name.LATEST,G);}B.find(".more").show();
d=frist_tab_name.LATEST;displayController([f,e,n],B,false);$("#leftside").offCanvas("close");break;default:a.href="city.html";break;}});var t=getQueryString("from");
if(t){if(t=="show"){m.eq(1).click();m.eq(0).on("click",function(){});}else{if(t=="star"){m.eq(2).click();}}}function x(){var I=frist_tab_name.RECOMMEND;
$.ajax({url:"/project/recommend",type:"GET",data:{page:recPage++},dataType:"json",beforeSend:function(){H.loading(I);},success:function(K){if(K.state=="success"){var J="";
ifHasData(K.object)?H.normal(I):H.nomore(I);for(i in K.object){var L=K.object[i];J+="<div class='tuijian'><img src='http://www.d-du.com/images/grey.gif' class='am-img-responsive vidPoster' data-original='"+L.vedioImage+"'/><img src='imgs/index/shipin@2x.png'/><div class='video'>"+L.vedioWebSource+"</div><a href='item.html?from=i&dealId="+L.dealId+"' class='link'><img src='http://www.d-du.com/images/grey.gif' class='am-img-responsive imgPoster' data-original='"+L.dealBanner+"'/><div class='intro am-vertical-align'><img src='imgs/index/yichou@3x.png' class='am-vertical-align-middle'/><span class='am-sans-serif am-vertical-align-middle'> 已筹"+L.successSupportCount+"</span><img src='imgs/index/shengyu@3x.png' class='am-vertical-align-middle'/><span class='am-sans-serif am-vertical-align-middle'> 剩余"+L.restDays+"天</span><img src='imgs/index/dachenglv-@3x.png' class='am-vertical-align-middle'/><span class='am-sans-serif am-vertical-align-middle'> 已达"+Math.floor(L.successSupportCount/L.totalSupportCount*100)+"%</span></div></a></div>";
}f.find(".more").before(J);$(".vidPoster").lazyload();$(".imgPoster").lazyload();$(".tuijian").each(function(){var P=$(this),N=P.find(".vidPoster"),M=N.next(),O=P.find(".imgPoster");
checkImgComplete(N[0],function(){N=P.find(".vidPoster");var Q=(N.height()-M.height())/2;M.css("top",Q).show().addClass("am-animation-fade");});checkImgComplete(O[0],function(){O=P.find(".imgPoster");
var Q=O.height()/2;P.find("img").last().css("bottom",Q);P.find(".intro").show().addClass("am-animation-fade");});M.on("click",function(){P.find(".video").css({width:N.width(),height:N.height(),left:N.css("marginLeft")}).show().find("iframe").attr({width:"100%",height:"100%"});
N.css("visibility","hidden");M.css("visibility","hidden");});});}else{alert(K.msg);}}});}function w(){var I=frist_tab_name.STAR;$.ajax({url:"/project/getSome",type:"GET",data:{page:xinPage++,cateId:4},dataType:"json",beforeSend:function(){H.loading(I);
},success:function(K){if(K.state=="success"){var J="";ifHasData(K.object)?H.normal(I):H.nomore(I);for(i in K.object){var L=K.object[i];J+="<a href='item_star.html?dealId="+L.dealId+"' class='renqi'><img src='http://www.d-du.com/images/grey.gif' data-original='"+L.videoImage+"' class='renqiPoster'><img src='imgs/renqi/dibumengban@3x.png' class='am-img-responsive renqi-mengban'><span>"+L.name+"</span><span>"+L.tags+"</span><button>支持</button></a>";
}n.find(".more").before(J);$(".renqiPoster").lazyload();checkImgComplete($(".renqiPoster")[0],function(){$(".renqi-mengban").show();n.find("span").show();
n.find("button").show();});}else{alert(K.msg);}}});}function b(){var K=frist_tab_name.DREAM,I=JSON.parse(session.getItem("user")),J=I?I.userId:0;$.ajax({url:"/project/getDream",type:"GET",data:{page:dreamPage++,cateId:7,userId:J},dataType:"json",beforeSend:function(){H.loading(K);
},success:function(N){if(N.state=="success"){var M="",L=N.object.isPraise?zan_img.ACITVE:zan_img.NORMAL;ifHasData(N.object)?H.normal(K):H.nomore(K);for(i in N.object){var O=N.object[i];
M+='<div class="dream"><a href="item_dream.html?dealId='+O.dealId+'" onclick="checkLogin($(this),'+J+');"><img src="imgs/index/tupianjiazai-4@2x.png" data-original='+O.image+' class="am-img-responsive dreamPoster"><div class="zan am-vertical-align"><img src="'+L+'" class="am-vertical-align-middle"><span class="am-vertical-align-middle">'+O.praiseNum+"</span></div></div>";
}g.find(".more").before(M);$(".dreamPoster").lazyload();}else{alert(N.msg);}}});}function A(L,I){var J="",K=null;switch($.trim(L)){case frist_tab_name.LATEST:J="/project/last";
K={page:D++};break;case frist_tab_name.EXPENSIVE:J="/project/highest";K={page:D++};break;case frist_tab_name.SUPPORT:J="/project/rank";K={page:D++};break;
case frist_tab_name.PERFORM:case second_tab_name.ALL:J="/project/allPro";K={page:D++};break;case second_tab_name.CONCERT:J="/project/singlePro";K={page:D++,cateId:1};
break;case second_tab_name.VARIETY:J="/project/singlePro";K={page:D++,cateId:2};break;case second_tab_name.OTHER:J="/project/singlePro";K={page:D++,cateId:3};
}$.ajax({url:J,type:"GET",data:K,dataType:"json",beforeSend:function(){H.loading(L);},success:function(Q){var P="";ifHasData(Q.object)?H.normal(L):H.nomore(L);
for(i in Q.object){var R=Q.object[i],N="",O=k=0,M=R.star;for(;O<M;O++){N+="<img class='paihang-star' src='imgs/paihang/star-1@2x.png'>";}for(;k<(5-M);k++){N+="<img class='paihang-star' src='imgs/paihang/star-2@2x.png'>";
}P+="<li class='am-g am-list-item-desced am-list-item-thumbed am-list-item-thumb-left'style='background:#202020;' onclick='support("+R.dealId+");'><div class='am-u-sm-4 am-u-md-2 am-list-thumb' style='margin-top:-.5rem;'><img src='imgs/paihang/tupianjiazai-@2x.png' data-original='"+R.image+"' class='am-img-responsive paihang-poster'/></div><div class='am-u-sm-8 am-u-md-10 am-list-main' style='padding-left:0rem;'><p class='paihang-title'>"+R.name+"</p><img class='paihang-jiantou' src='imgs/paihang/xiayiji@2x.png'><div class='paihang-content'><span class='am-sans-serif'>目标"+R.totalSupportCount+"</span><span class='am-sans-serif'>已筹"+R.successSupportCount+"</span><span class='am-sans-serif'>剩余"+R.restDays+"天</span></div>"+N+"<a class='paihang-support am-sans-serif' href='javascript:void(0);'>立即支持</a></div></li>";
}I.append(P);$(".paihang-poster").lazyload({threshold:-50});}});}B.find(".more").on("click",function(){A(d,G);});e.find(".more").on("click",function(){A(d,q);
});f.find(".more").on("click",function(){x();});n.find(".more").on("click",function(){w();});g.find(".more").on("click",function(){b();});$(".search").on("click",function(){a.href="search.html";
});var C=$("#right-nav");var o=C.find("a");var h=newRightLists(o);var v=newAddLists();var r=session.getItem("imgurl");var u=session.getItem("QQWXuserName");
var z=navigator.userAgent.toLowerCase();var y=session.getItem("flag");if(session.getItem("status")!="online"){if(z.match(/MicroMessenger/i)=="micromessenger"&&(session.getItem("flag")==""||!session.getItem("flag"))){a.href="/user/WechatWebLogin";
}else{if(y=="success"){loginSucView(r,decodeURI(u),h,v);p();j();var E=JSON.stringify(new User(c,decodeURI(u),null,null,r,null));session.setItem("status","online");
session.setItem("user",E);}else{if(y=="fail"){r=u=h=null;alert("登录失败！flag="+y);}}}}else{j();var s=JSON.parse(session.getItem("user"));r=(y=="success")?session.getItem("imgurl"):s.imgurl;
loginSucView(r,decodeURI(s.nickname),h,v);p();}function j(){if(z.match(/MicroMessenger/i)=="micromessenger"){o.last().hide();}}function p(){C.delegate("li",clickEvent(),function(){var I=$.trim($(this).find("span").html());
switch(I){case right_list.UINFO:a.href="myInfo.html?from=index";break;case right_list.UWALLET:a.href="myWallet.html";break;case right_list.ULOVE:a.href="myLove.html";
break;case right_list.UORDER:a.href="myOrder.html";break;case right_list.SHARE:a.href="share.html";break;case right_list.LOGOUT:session.clear();a.href="/user/Logout";
break;}});}});$(window).resize(function(){initPage($(".tuijian"));});$(window).load(function(){var a=$("#location");if(session.hasChangeCity!="true"){setTimeout(function(){if(session.getLocation=="success"){a.html(session.getItem("curCity"));
}else{}},1000);}else{a.html(session.getItem("newCity"));}});function checkImgComplete(a,b){var c=setInterval(function(){if(a.complete){if(a.src!="http://www.d-du.com/images/grey.gif"){b();
clearInterval(c);}}},100);}function showTip(a){$("#tipCont").html(a);$("#sendTip").modal();}function checkLogin(b,a){if(!a){showTip(modal_tip.NOTLOGIN);
b.attr("href","javascript:void(0)");}}function initPage(a){a.each(function(){var c=$(this).find(".vidPoster"),b=c.next();b.css("top",(c.height()-b.height())/2);
$(this).find("img").last().css("bottom",$(this).find(".imgPoster").height()/2);});}function ifHasData(a){return(!a||(a&&a.length==0))?false:true;}function changeTabColor(b,a){b.css({color:"#fff",borderRadius:"none",background:"#202020"});
a.css({color:"#1dbcd2",borderRadius:"2rem",background:"#000"});}function support(b){var a=window.location;a.href="item.html?from=i&dealId="+b;}function loginSucView(f,d,b,g){var c=$(".user-header"),a=$(".user-title");
c.attr("src",f);a.html(d);for(list in b){var e=b[list].ele;e.children("img").attr("src",b[list].iconSrc);e.children("span").html(b[list].listName);e.attr("href","javascript:void(0)");
}for(list in g){var e=g[list];$(".right-nav li").last().before('<li><a href="javascript:void(0);"><img src="'+e.iconSrc+'"><span>'+e.listName+"</span></a></li>");
}}function newRightLists(b){var d=new Array();var f={ele:b.eq(0),iconSrc:"imgs/index/gerenziliao-@2x.png",listName:right_list.UINFO};var e={ele:b.eq(1),iconSrc:"imgs/index/wodeqianbao-@2x.png",listName:right_list.UWALLET};
var c={ele:b.eq(2),iconSrc:"imgs/index/wodeshoucang-@2x.png",listName:right_list.ULOVE};var a={ele:b.eq(3),iconSrc:"imgs/index/tuichudenglu-@2x.png",listName:" "+right_list.LOGOUT};
d.push(f,e,c,a);return d;}function newAddLists(){var a=new Array();var c={iconSrc:"imgs/index/wodedingdan@2x.png",listName:" "+right_list.UORDER};var b={iconSrc:"imgs/index/fenxiangyouli-@2x.png",listName:" "+right_list.SHARE};
a.push(c);return a;}