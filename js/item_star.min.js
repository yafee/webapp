var tip_send={NOTLOGIN:"请先登录哦～",NULL:"请输入内容哦～"},moreBtn_content={NORMAL:"点击查看更多 &raquo;",LOADING:"加载中...",NOMORE:"没有更多"},head_img="imgs/login/touxiang-1@2x.png",love_img={NORMAL:"imgs/item/nolove@2x.png",LOVE:"imgs/item/love@2x.png"},zan_img={NORMAL:"imgs/item/zan@3x.png",ACTIVE:"imgs/item/zan_2@3x.png"},unit={RMB:"¥",DAY:"天",PERCENT:"%"},star_img={NORMAL:"imgs/item/star_1@3x.png",ACTIVE:"imgs/item/star_2@3x.png"},tab_icon={XNORMAL:"imgs/item/xiangqing_1@3x.png",XACTIVE:"imgs/item/xiangqing_2@3x.png",PNORMAL:"imgs/item/pinglun_1@3x.png",PACTIVE:"imgs/item/pinglun_2-@3x.png",SNORMAL:"imgs/item/guize_2@3x.png",SACTIVE:"imgs/item/guize_1@3x.png"},finish='<img src="imgs/myLove/yiwancheng-@2x.png" class="finish absolute">';
$(function(){var y=$(".play"),m=$(".video"),q=$(".love"),A=$("#zan"),h=$("#support"),o=1,k=getQueryString("dealId"),t=$("#imgList"),f=$(".more"),b=f.find("a"),g=$("#bottom"),C=$("#fenxiang"),u=$("#sendMsg"),n=u.find("textarea"),D=JSON.parse(window.sessionStorage.getItem("user"));
praiseNum=$("#praiseNum");$.ajax({url:"/detail/detailPage",type:"GET",data:{dealId:k,userId:(!D)?0:D.userId},dataType:"json",success:function(J){if(J.state=="success"){var K=J.object,H=J.object.requestData[0],F=K.himage,L=K.simage,M=$(".poster"),G=$(".main"),N="";
H.isFinished&&M.before(finish);q[0].src=K.isFocus?love_img.LOVE:love_img.NORMAL;M[0].src=H.vedioImage;checkImgComplete(M[0],function(){initPage(y,M,q);
});A[0].src=K.isPraise?zan_img.ACTIVE:zan_img.NORMAL;praiseNum.html(K.praiseNum);m[0].innerHTML=H.vedioWebSource;y.on("click",function(){q.hide();m.css({width:M.width(),height:M.height(),left:M.css("marginLeft")}).show().find("iframe").attr({width:"100%",height:"100%"});
M.css("visibility","hidden");y.css("visibility","hidden");});var E="",I=j=0;for(;I<H.star;I++){E+='<img src="'+star_img.ACTIVE+'">';}for(;j<(5-H.star);
j++){E+='<img src="'+star_img.NORMAL+'">';}$(".title").html(H.name);$("#stars")[0].innerHTML=E;$("#startTime").html(H.startTime);$("#address").html(H.address);
$("#successCount").html(unit.RMB+H.successSupportCount);$("#restDays").html(H.restDays+unit.DAY);$("#dacheng").html(Math.floor(H.successSupportCount/H.totalSupportCount*100)+unit.PERCENT);
$("#totalCount").html(unit.RMB+H.totalSupportCount);$("#totalDays").html(H.totalDays+unit.DAY);for(I in L){N+='<img src="imgs/index/tupianjiazai-4@2x.png" data-original="'+L[I]+'" class="am-img-responsive descImg" style="width:100%;">';
}t[0].innerHTML=N;$(".descImg").lazyload({threshold:-50});}else{alert(J.msg);}}});q.on("click",function(){if(!D){x(tip_send.NOTLOGIN);}else{$.ajax({url:"/project/isFocus",type:"POST",data:{dealId:k,userId:D.userId},dataType:"json",beforeSend:function(){$(".loadingWrap").show();
},success:function(E){if(E.state=="success"){$(".loadingWrap").hide();if(q.attr("src")==love_img.LOVE){q.animate({opacity:"toggle"},150).attr("src",love_img.NORMAL).animate({opacity:"toggle"},150);
}else{q.animate({opacity:"toggle"},150).animate({opacity:"toggle"},150).attr("src",love_img.LOVE);}}else{alert(E.msg);}}});}});A.on("click",function(){if(!D){x(tip_send.NOTLOGIN);
}else{$.ajax({url:"/praise/dianzhan",type:"GET",data:{dealId:k,userId:D.userId},success:function(E){if(E.state=="success"){if(A.attr("src")==zan_img.NORMAL){A[0].src=zan_img.ACTIVE;
praiseNum.html(parseInt(praiseNum.html())+1);}}else{alert(E.msg);}}});}});var z=$("#ximg"),s=$("#pimg"),a=$("#simg");var p=$("#xfont"),r=$("#pfont"),l=$("#sfont");
var B=$(".xiangqing"),v=$(".pinglun"),e=$(".shiyong");var d=$(".xiangqing-content"),c=$("#guize");v.on("click",function(){changeTab.clearTab(z,tab_icon.XNORMAL,p,B);
changeTab.clearTab(a,tab_icon.SNORMAL,l,e);changeTab.activeTab(s,tab_icon.PACTIVE,r,v);$(".pinglun-content").remove();o=1;w();displayController([d,t,c],f,false);
});f.on("click",function(){w();});B.on("click",function(){changeTab.clearTab(s,tab_icon.PNORMAL,r,v);changeTab.clearTab(a,tab_icon.SNORMAL,l,e);changeTab.activeTab(z,tab_icon.XACTIVE,p,B);
$(".pinglun-content").remove();displayController([f,c],[d,t],false);});e.on("click",function(){changeTab.clearTab(z,tab_icon.XNORMAL,p,B);changeTab.clearTab(s,tab_icon.PNORMAL,r,v);
changeTab.activeTab(a,tab_icon.SACTIVE,l,e);$(".pinglun-content").remove();displayController([d,t,f],c,false);});g.find("input").focus(function(){displayController(g,u,false);
n.focus();});$(".cancel").on("click",function(){displayController(u,g,false);});$(".send").on("click",function(){if(!D){x(tip_send.NOTLOGIN);}else{if(trim(n.val())==""){x(tip_send.NULL);
}else{$.ajax({url:"/Comment/saveComments",type:"POST",data:{dealId:k,userId:D.userId,userName:D.nickname,content:n.val()},dataType:"json",success:function(E){if(E.state=="success"){v.click();
displayController(u,g,false);}else{alert(E.msg);}}});}}});h.on("click",function(){if(!D){x(tip_send.NOTLOGIN);}else{var E=window.location;E.href="support.html?dealId="+k;
}});function w(){$.ajax({url:"/Comment/getComments",type:"GET",data:{page:o++,dealId:k},dataType:"json",beforeSend:function(){b.html(moreBtn_content.LOADING);
},success:function(G){if(G.state=="success"){if(!G.object||G.object.length==0){b.html(moreBtn_content.NOMORE);}else{b.html(moreBtn_content.NORMAL);var F="",E;
for(i in G.object){var H=G.object[i];E=((!H.headImg)||(H.headImg==""))?head_img:H.headImg;F+='<ul class="pinglun-content am-text-sm"><li><img src="'+E+'" class="am-margin-right-sm"><span>'+H.dealUserName+" : "+H.content+"</span></li></ul>";
}f.before(F);}}else{alert(G.msg);}}});}$(".back").on("click",function(){var E="";switch(getQueryString("from")){case"l":E="myLove.html";break;case"i":default:E="index.html";
break;}location.href=E;});function x(E){$("#tipCont").html(E);$("#sendTip").modal();}});$(window).load(function(){$(".loadingWrap").hide();});$(window).resize(function(){initPage($(".play"),$(".poster"),$(".love"));
});$(window).scroll(function(){var b=parseInt($("#dacheng").html()),a=$(".num");if($(document).scrollTop()>=130){if(b>=100){a.width("99.6%");}else{a.width(b+"%");
}return;}});function checkImgComplete(a,c){var b=setInterval(function(){if(a.complete){c();clearInterval(b);}},50);}function initPage(a,c,b){a.css({top:((c.height()-a.height())/2),display:"block"});
b.show();}var changeTab={clearTab:function(b,d,a,c){b[0].src=d;a.css("color","#fff");c.css("borderBottom","none");},activeTab:function(b,d,a,c){b[0].src=d;
a.css("color","#2BC0D4");c.css("borderBottom",".1rem solid #2BC0D4");}};